<!doctype html>
<html>
<head>
    <title>Test Automation Report</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remodal/1.1.1/remodal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remodal/1.1.1/remodal-default-theme.css">
    <style type="text/css">
        pre {
            word-break: keep-all !important;
            word-wrap: normal !important;
            overflow-x: scroll !important;
        }
        #cd-timeline {
            position: relative;
            padding: 2em 0;
            margin-top: 2em;
            margin-bottom: 2em;
        }
        #cd-timeline::before {
            /* this is the vertical line */
            content: '';
            position: absolute;
            top: 0;
            left: 18px;
            height: 100%;
            width: 4px;
            background: #d7e4ed;
        }
        .cssanimations .cd-timeline-img.is-hidden {
            visibility: hidden;
        }
        .cssanimations .cd-timeline-img.bounce-in {
            visibility: visible;
            animation: cd-bounce-1 0.6s;
        }

        @keyframes cd-bounce-1 {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }

            60% {
                opacity: 1;
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
<pre>{{  dump() }}</pre>
<pre></pre>
{% for suite in report %}
    {% import _self as rep %}

<div class="container remodal-bg">
    <header class="page-header">
        {% if suite.total_tests > 0 %}
            <small>
                Ran a total of {{ suite.total_tests }} tests.
            </small>
        {% endif %}

        <p>
            <small>
                {% if suite.total_passed > 0 %}
                    <a href="javascript:void(0)"
                       data-show-msg="Show Passed Tests ({{ suite.total_passed }})"
                       data-hide-msg="Hide Passed Tests ({{ suite.total_passed }})"
                       data-target="section.passed-feature, section.passed-test "
                       class="btn btn-success feature-toggle"
                    >
                        Show Passed Tests ({{ suite.total_passed }})
                    </a>
                {% endif %}

                {% if suite.total_failures > 0 %}
                    <a href="javascript:void(0)"
                       data-show-msg="Show Failed Tests ({{ suite.total_failures }})"
                       data-hide-msg="Hide Failed Tests ({{ suite.total_failures }})"
                       data-target="section.failed-feature, section.failed-test"
                       class="btn btn-danger feature-toggle"
                    >
                        Hide Failed Tests ({{ suite.total_failures }})
                    </a>
                {% endif %}
            </small>
        </p>
    </header>

    {% if not suite.successful %}
        <div class="progress">
            <div class="progress-bar progress-bar-success" style="width: {{ suite.success_percentage }}%">
                <span class="sr-only">{{ suite.total_passed }}</span>
            </div>
            <div class="progress-bar progress-bar-danger" style="width: {{ suite.failure_percentage }}%">
                <span class="sr-only">{{ suite.total_failures }}</span>
            </div>
        </div>
    {% endif %}

    {{ rep.parse_suite(suite) }}
</div>
{% endfor %}


</body>
</html>

{% macro parse_suite(suite) %}
<div class="panel panel-default">
    <div class="panel-heading">{{ suite.title }}</div>
    <div class="panel-body" style="display: none">sth</div>
    <ul class="list-group">
    {% for test in suite.children %}
            {% import _self as rep %}
            {% if test.type == "child_suite" %}
                {{ rep.parse_child_suite(test) }}
            {% endif %}

            {% if test.type == "test" %}
                {{ rep.parse_test(test, loop.index) }}
            {% endif %}

    {% endfor %}
    </ul>
</div>
{%  endmacro parse_suite %}

{# Child test suites are shown as sections #}
{% macro parse_child_suite(suite) %}
            {% for child in suite.children %}
                {% import _self as rep %}
                {% set number = loop.index*1000 %} }}
                {{ rep.parse_test(child, number) }}
            {% endfor %}

{% endmacro parse_child_suite %}

{# Parse tests as sections and their exceptions as list items #}
{% macro parse_test(test, index) %}
<pre>dupa</pre>
    <li class="list-group-item" data-remodal-target="modal-{{ index }}">
        <p>{{ test.title }}</p>
    </li>
    <div class="remodal" data-remodal-id="modal-{{ index }}">
        <button data-remodal-action="close" class="remodal-close"></button>
        <h1>{{ test.title }}</h1>
              {% if test.children is not empty %}
                  <section id="cd-timeline">
                    {% for event in test.children %}
                        {% if event.type == "failure" %}
                            Failure
                            {% import _self as rep %}
                            <li class="{{ rep.parse_message_class(event.type) }}" title="{{ event.type }}">
                                <pre>{{ "#{event.exception_type}\n\n#{event.exception_msg}" }}</pre>
                                <pre>{{ event.exception_trace }}</pre>
                            </li>
                        {% elseif event.type == "http_transaction" %}
                            {% if loop.first %}
                                Performed HTTP transactions
                            {% endif %}

                        <div class="cd-timeline-block">

                                {{- event.request_method }} on {{ event.request_url }}.
                                                            <pre>
                                                                {{- event.request | escape }}
                                                            </pre>
                                    <pre>
                                                                {{- event.response | escape }}
                                                            </pre>
                                </div>
                        {% endif %}
                    {% endfor %}

                  </section>
                    {#{% if test.traffic_logger_content %}#}
                        {#<li class="test-execution-item list-group-item">#}
                            {#<a class="btn btn-primary" href="{{ test.traffic_logger_file }}" target="_blank">#}
                                {#Download HAR#}
                            {#</a>#}
                            {#<button class="btn btn-primary showhar">Show HAR</button>#}
                        {#</li>#}
                        {#<li class="test-execution-item list-group-item hidden harContent">#}
                            {#{{ test.traffic_logger_content }}#}
                        {#</li>#}
                    {#{% else %}#}
                        {#{% if test.traffic_logger_file %}#}
                            {#<li class="test-execution-item list-group-item">#}
                                {#<a href="{{ test.traffic_logger_file }}" target="_blank">#}
                                    {#Download HAR#}
                                {#</a>#}
                            {#</li>#}
                        {#{% endif %}#}
                    {#{% endif %}#}
                {#</ul>#}
            {% endif %}

        <br>
        <button data-remodal-action="cancel" class="remodal-cancel">Cancel</button>
        <button data-remodal-action="confirm" class="remodal-confirm">OK</button>
{% endmacro parse_test %}

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/remodal/1.1.1/remodal.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
<script src="http://logo.olx.pl/images_pmaciejewski/har-viewer.js"></script>
<link rel='stylesheet' href='http://logo.olx.pl/images_pmaciejewski/har-viewer.css'/>
<link rel='stylesheet' href='https://code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css'/>

<script>
    $(function () {
        $(".showhar").on("click", function() {
            var $this = $(this);
            var $modalArea = $("#modal-body");
            var dataContent = $this.parent().siblings('.harContent').html();
            var data = JSON.parse(dataContent);
            $modalArea.html(
                '<div class="overlay-contents" style="height: 300px; overflow: auto; margin-bottom: 15px;">' +
                '<div class="harContentRender"></div>' +
                '</div>'
            );
            var modal = $("#modal");
            modal.modal();
            var content = modal.find('.harContentRender').HarView();
            var har = content.data('HarView');
            har.render(data);
        });
        $(".show-expected-exception").on("click", function (e) {
            $(this).siblings(".expected-exception-stacktrace").show();
            $(this).hide();
            e.preventDefault();
        });

        $(".test-execution-item-action").each(function () {
            this.innerHTML = this.innerHTML.replace(/https?:\/\/[^ ]+/, function (match) {
                return "<a href=\"" + match + "\" target=\"_blank\">" + match + "</a>"
            })
        });


        $(".feature-toggle").click(function(){
            var $this   = $(this);
            var $target = $($this.attr('data-target'));

            $target.toggle(function(){
                if ($target.is(":visible")) {
                    $this.text($this.attr('data-hide-msg'));
                } else {
                    $this.text($this.attr('data-show-msg'));
                }
            });
        });

        $(".toggle-children").click(function(event){
            event.stopPropagation();
            var $button = $(this);
            var $target = $(this).parent().nextUntil('.step-item');

            $target.toggleClass("hidden", function(){
                if ($target.is(':visible')) {
                    $button.html('<span class="glyphicon glyphicon-minus"></span>');
                } else {
                    $button.html('<span class="glyphicon glyphicon-plus"></span>');
                }
            });
        });

        $(".accordion-test").accordion({
            active: 1,
            collapsible: true,
            header: "div.test-heading",
            heightStyle: "content"
        });

        $(".accordion-feature").accordion({
            active: 1,
            collapsible: true,
            header: "div.feature-heading",
            heightStyle: "content"
        });

        $(window).on('scroll', function(){
            $timeline_block.each(function(){
                if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.75 && $(this).find('.cd-timeline-img').hasClass('is-hidden') ) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                }
            });
        });

    });
</script>

<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Details</h4>
            </div>
            <div class="modal-body" id="modal-body" style="max-height: 100%">
            </div>
        </div>
    </div>
</div>